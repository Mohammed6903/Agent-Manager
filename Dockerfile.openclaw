FROM node:22-bookworm-slim

# git is required by some of openclaw's npm dependencies;
# force HTTPS instead of SSH so it works without an SSH key.
RUN apt-get update && apt-get install -y --no-install-recommends git ca-certificates \
    && rm -rf /var/lib/apt/lists/* \
    && git config --global url."https://github.com/".insteadOf ssh://git@github.com/ \
    && git config --global --add url."https://github.com/".insteadOf git@github.com:

# Install OpenClaw gateway via npm (lighter than building from source)
RUN npm install -g openclaw@2026.2.17

WORKDIR /app

ENV NODE_ENV=production

EXPOSE 18789 18790

# Gateway binds to lan (0.0.0.0) for Docker networking.
# --allow-unconfigured lets it start without a prior onboard run.
CMD ["openclaw", "gateway", "--bind", "lan", "--port", "18789", "--allow-unconfigured"]
